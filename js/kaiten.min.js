Kaiten={version:"1.2 (2012-03-17)",options:{columnWidth:"320px",optionsSelector:"",startup:null,connectors:[],fallbackConnector:"iframe",defaultPanelTitleBarOptions:'<div class="block-nav"><div class="items clickable remove-panel"><div class="label">Remove this panel</div></div></div>'},_create:function(){if(this._check4Requirements()===false){return}this._createMarkup();this._initState();this._initConnectors();this._bindEvents();this._doLayout();this._startup()},_createMarkup:function(){var b='<div id="k-window"><div id="k-topbar"><div id="mask" class="'+Kaiten.selectors.maskClass+'-20" /><div id="k-breadcrumb"></div></div><div id="k-slider"></div></div>';$(b).appendTo(this.element);this.$kWindow=this.element.find(this.selectors.window);this.$slider=this.element.find(this.selectors.slider);var a=this.element.css("position");if(!a||(a==="static")){this.element.css("position","relative")}if(!this.element.width()){this.element.css({width:"100%"})}if(!this.element.height()){this.element.css({height:"100%"})}this._createTopBar()},_initState:function(){var a=$('script[src*="kaiten.js"],script[src*="kaiten.min.js"]').prop("src"),d=a.substring(0,a.lastIndexOf("kaiten.js"));this._state={columnsCount:1,prevColumnsCount:1,columnWidth:320,hasTouchScreen:("ontouchstart" in window),tabID:Math.floor(Math.random()*99999999999).toString(),panelsCount:0,anims:{count:0,delayedLayout:false},focus:{panelIndex:0,navItemIndex:null,typing:""},connectors:Kaiten._state.connectors||{},css:{},basePath:d};var c=this.$kWindow.width(),b=parseInt(this.options.columnWidth,10);if(/[0-9]%$/.test(this.options.columnWidth)){if((b>100)||(b<=0)){b=100}this.options.columnWidth=c*b/100}else{if((b<=0)||(b>c)){this.options.columnWidth=c}else{if(b<this._constants.minColumnWidth){this.options.columnWidth=this._constants.minColumnWidth}}this.options.columnWidth=b}this._state.columnsCount=Math.floor(c/this.options.columnWidth);this._state.prevColumnsCount=this._state.columnsCount;this._state.columnWidth=c/this._state.columnsCount;this._updateColumnsControls()},_createTopBar:function(){var c="";if(this.options.optionsSelector!==""){var d=$(this.options.optionsSelector);c='<div id="options-custom" class="line">'+d.html()+"</div>";d.remove()}var b='<div id="menu-border" /><div id="menu-container"><button id="newtab-button" title="Open the application in a new tab" accesskey="t" onclick="window.open(document.location.href, \'\');" /><button id="options-button" title="Options" accesskey="o" /></div><div id="options-dlg" class="box-shadow"><div id="columns-controls" class="line"><strong id="columns-count"></strong><button id="columns-inc" accesskey="p" title="+"/></button><button id="columns-dec" accesskey="m" title="-"/></div>'+c+'<div class="line footer"><p>Kaiten v'+this.version+"</p><p>Â© 2004-2011 Nectil S.A. all rights reserved.</p></div></div>";this.element.find(this.selectors.topbar).append(b);var a=this;this.element.find(this.selectors.columnsInc).click(function(){if(a._state.anims.count>0){return}a.setColumnsCount(a._state.columnsCount+1);a._updateColumnsControls()});this.element.find(this.selectors.columnsDec).click(function(){if(a._state.anims.count>0){return}a.setColumnsCount(a._state.columnsCount-1);a._updateColumnsControls()});this.element.find(this.selectors.optionsButton).click(function(h){var g=$(this),f=a.element.find(a.selectors.optionsDialog);if(f.is(":hidden")){h.stopPropagation();f.fadeIn(125);$(document).bind("click",function(j){var i=$(j.target);if(i.closest(a.selectors.optionsDialog).length===0){$(document).unbind("click");f.hide();g.toggleClass(a.selectors.activeClass)}})}else{$(document).unbind("click");f.hide()}g.toggleClass(a.selectors.activeClass)});this.$breadcrumb=this.element.find(this.selectors.breadcrumb).kbreadcrumb({});this._constants.topBarHeight=$(this.selectors.topbar).outerHeight(true)},_createDownloadIFrame:function(){$("<iframe />",{id:"iframe-download","class":"hidden",src:""}).prependTo(this.element).load(function(){var b=$(this),a=b.contents().find("html body").html();if(a!==""){var c="Download error ("+b.attr("src")+") !\n\n"+a;alert(c)}})},_bindEvents:function(){var b=this;this.element.resize(function(c){b._doLayout()});$(window).bind("orientationchange",function(c){b._doLayout()});if(!this._state.hasTouchScreen){this._initKeyboardNavigation()}var a=this._constants.panelLeftTools.concat(this._constants.panelRightTools);this.element.delegate(this.selectors.panelItems.titleBar,"click",function(j){var d=$(j.target),k=$(this).closest(b.selectors.panel);if(!k.hasClass(b.selectors.focusClass)){var h=b.selectors.panelItems.tools,c=":not(."+b.selectors.disabledClass+")";if(!d.is(h.prev+c)&&!d.is(h.next+c)){b.setPanelFocus(k)}}var g,f;for(g=a.length-1;g>=0;g--){f=a[g];if($.isFunction(f.callback)&&d.hasClass(f.cssClass)){f.callback.call(d[0],j,k,b.element);return}}});this.element.delegate(this.selectors.panelItems.titleBar,"dblclick",function(c){if(!$(c.target).hasClass(b.selectors.panelItems.toolClass)){$(this).closest(b.selectors.panel).kpanel("toggleOptions");return}});this.element.delegate(this.selectors.items.removePanel,"click",function(c){b.remove($(this).closest(b.selectors.panel))});this.element.bind("animstart.kpanel",function(c){b._state.anims.count+=1});this.element.bind("animcomplete.kpanel",function(c){b._state.anims.count-=1;if(b._state.anims.count<=0){if(b._state.anims.delayedLayout===true){console.info("Kaiten layout retry...");b._state.anims.delayedLayout=false;b._doLayout()}}});this.element.bind("nextplacement.kaiten",function(d,f,c,g){b._nextPlacement(f,c,g)});this.element.bind("prevplacement.kaiten",function(d,f,c,g){b._prevPlacement(f,c,g)});this.element.bind("afterdestroy.kpanel",function(r,k,s){b._state.panelsCount-=1;if(k&&(b._state.panelsCount>0)){var t=b._getVisiblePanels(),u=t.length;if(u===0){b.slideTo(b.getPanel(b._state.panelsCount-1))}else{if(s&&(b._state.panelsCount>u)){var q=b._getPrevPanels(":hidden",t.first()),c=t.last().kpanel("getState"),d=b._state.columnsCount-(c.position+c.width),m=d,w=q.first(),p=[];b._sortHiddenPanels(q,0);do{optimalWidth=w.kpanel("getState").optimalWidth;p.push({$panel:w,futureWidth:optimalWidth});m-=optimalWidth;w=w.prev(b.selectors.panel)}while((m>0)&&(w.length>0));if(m<0){p[p.length-1].futureWidth+=m;m=0}var j,f,h=0;for(j=p.length-1;j>=0;j--){var g=p[j];var o=g.$panel.kpanel("getState",true);g.$panel.show().kpanel("animate",h-o.position,g.futureWidth-o.width,b._state);h+=g.futureWidth}var v=d-m;for(j=0;j<u;j++){t.eq(j).kpanel("animate",v,null,b._state)}}}}})},_initConnectors:function(){var a,d,b=this;for(a in this._constants.connectors){this.registerConnector(this._constants.connectors[a])}for(d in this.options.connectors){this.registerConnector(this.options.connectors[d])}this.element.delegate(this.selectors.items.nonavigable,"click",function(f){f.stopPropagation()});var c=[this.selectors.items.navigable,this.selectors.panel+" "+this.selectors.connectable];this.element.delegate(c.join(),"click",function(g){var f=$(this);if(f.is("a")&&!f.data("load")){b._onClickLink(g,f)}else{b._onClickNavItem(g,f)}});this._createDownloadIFrame();this.element.delegate(this.selectors.downloadable,"click",function(g){var h,f=$(this);if(f.is("a")&&!f.data("load")){g.preventDefault();h=f.attr("href")}else{h=f.data("load").url}b.element.children(b.selectors.iFrameDownload).attr("src",h)})},_startup:function(){if($.isFunction(this.options.startup)){var c=null;if(window.location.search!==""){var b,a,d,e=window.location.search.split("?").pop().split("&");c={};for(b=0,a=e.length;b<a;b++){d=e[b].split("=");c[d[0]]=decodeURIComponent(d[1]).replace(/\+/g," ")}if(c.kURL){c=this.findLoaderData(c.kURL)}}this.options.startup.call(this.element,c)}},_setOption:function(b,c){switch(b){case"columnWidth":this.setColumnWidth(c);break;case"connectors":if($.isPlainObject(c)){for(n in c){if(c.hasOwnProperty(n)){this.registerConnector(n,c[n])}}}break;case"optionsSelector":if(c!==""){var d=$(c);if(d.length===0){break}var a='<div id="options-custom" class="line">'+d.html()+"</div>";d.remove();this.element.find(this.selectors.optionsCustom).html(a)}break;default:break}$.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){this.element.find(this.selectors.panel).kpanel("destroy");this.element.unbind().undelegate().empty();$.Widget.prototype.destroy.apply(this,arguments)},selectors:{window:"#k-window",slider:"#k-slider",topbar:"#k-topbar",topbarMask:"#k-topbar #mask",appMenuBorder:"#k-topbar #menu-border",appMenuContainer:"#k-topbar #menu-container",optionsButton:"#k-topbar #options-button",optionsDialog:"#k-topbar #options-dlg",optionsCustom:"#k-topbar #options-custom",columnsCount:"#k-topbar #columns-count",columnsInc:"#k-topbar #columns-inc",columnsDec:"#k-topbar #columns-dec",breadcrumb:"#k-breadcrumb",breadcrumbItems:{homeClass:"home",lastClass:"last",itemIDPrefix:"crumb",rVisibleClass:"r-visible",rInvisibleClass:"r-invisible"},iFrameDownload:"#iframe-download",loaderClass:"loader",maskClass:"mask",panel:".k-panel",panelClass:"k-panel",panelIDPrefix:"kp",panelItems:{mask:".mask",loader:".loader",titleBarClass:"titlebar",titleBar:".titlebar",title:".titlebar .title",titleClass:"title",titleContainerClass:"center",leftToolbarClass:"left",rightToolbarClass:"right",toolClass:"tool",tools:{all:".titlebar .tool",prev:".titlebar .nav-prev",prevClass:"nav-prev",next:".titlebar .nav-next",nextClass:"nav-next",reload:".titlebar .reload",newtab:".titlebar .newtab",maximize:".titlebar .maximize"},optionsClass:"panel-options",options:".panel-options",headerClass:"panel-header",header:".panel-header",bodyClass:"panel-body",body:".panel-body",blockClass:"block",blockNavClass:"block-nav",blockIFrameClass:"block-iframe",blockExitClass:"block-exit"},items:{itemsClass:"items",label:".label",labelClass:"label",infoClass:"info",info:".info",head:".head",headClass:"head",tailClass:"tail",summaryClass:"summary",separatorClass:"separator",navigable:".navigable:visible",navigableClass:"navigable",nonavigable:".no-nav",nonavigableClass:"no-nav",clickable:".clickable",clickableClass:"clickable",removePanel:".clickable.remove-panel",removePanelClass:"remove-panel"},connectable:"a[href]:visible:not(.no-nav,.k-download)",activeClass:"k-active",focusClass:"k-focus",externalClass:"k-external",exitClass:"k-exit",newTabClass:"k-newtab",disabledClass:"disabled",visibleClass:"visible",invisibleClass:"invisible",downloadableClass:"k-download",downloadable:".k-download"},_state:{anims:{},focus:{},connectors:{},css:{}},_constants:{minColumnWidth:200,clearTypeDelay:1000,panelLeftTools:[{cssClass:"nav-prev",title:"Previous panel",callback:function(b,c,a){b.preventDefault();a.kaiten("prev")}},{cssClass:"remove",title:"Remove",callback:function(b,c,a){b.preventDefault();c.kpanel("destroy",null,null,null,true)}},{cssClass:"reload",title:"Reload",callback:function(b,c,a){b.preventDefault();c.kpanel("reload")}}],panelRightTools:[{cssClass:"maximize",title:"Resize",callback:function(b,c,a){b.preventDefault();if(!$(this).hasClass(Kaiten.selectors.activeClass)){c.kpanel("maximize",self.element)}else{c.kpanel("originalSize",self.element)}$(this).toggleClass(Kaiten.selectors.activeClass)}},{cssClass:"newtab",title:"Open this panel in a new tab",callback:function(b,c,a){b.preventDefault();c.kpanel("newTab")}},{cssClass:"nav-next",title:"Next panel",callback:function(b,c,a){b.preventDefault();a.kaiten("next")}}],connectors:[{collectionName:"html",connectors:[{name:"page",loader:function(b,c,a){return $.get(b.url,b.data)}},{name:"string",loader:function(d,e,b){var c=d.html;var a=$("<div />",{"class":Kaiten.selectors.panelItems.bodyClass}).append(c);if(c instanceof jQuery){return a.clone(true,true)}return a}},{name:"dom",loader:function(c,d,a){var b=$(c.contentSelector);if(!b.length){throw new Error('Cannot find DOM element! (selector="'+c.contentSelector+'")')}return b.children().clone(true,true)}}]},{name:"iframe",loader:function(d,f,a){if(!d.url){throw new Error("Missing URL! Cannot load content in an iframe.")}var e=d.kTitle||d.url;f.kpanel("setTitle",e);var c=Kaiten.selectors.panelItems;var b='<div class="'+c.headerClass+'"><div class="'+c.blockExitClass+'"><span class="warning"/>This is an external Website.<br/><span style="font-size:80%;"><a href="'+d.url+'" class="'+Kaiten.selectors.exitClass+'">Click here open this link in a new window.</a></span></div></div><div class="'+c.bodyClass+'" optimal-width="900px"><div class="shadow"></div><div class="'+c.blockIFrameClass+'"><iframe src="'+d.url+'" width="100%" height="100%" class="loader" onload="$(this).removeClass(\'loader\');" /></div></div>';return b},connectable:function(b,a){return a.hasClass(Kaiten.selectors.externalClass)},getData:function(b,a){return{url:b}}}]},_check4Requirements:function(){var b=(($.browser.mozilla===true)||($.browser.webkit===true)||($.browser.opera===true)||($.browser.msie===true&&parseInt($.browser.version,10)>=8));if(!b){var a=$('<p style="text-align:center;margin-top:20%;">Unfortunately, your browser is not supported by Kaiten.<br/>Please use <a href="http://www.firefox.com/" target="_blank"><strong>Firefox</strong></a>, <a href="http://www.apple.com/safari/" target="_blank"><strong>Safari</strong></a>, <a href="http://www.google.com/chrome" target="_blank"><strong>Chrome</strong></a>, <a href="http://www.opera.com/" target="_blank"><strong>Opera</strong></a>, or <a href="http://www.microsoft.com/ie/" target="_blank"><strong>IE version 8 or later</strong></a>.</p>');a.appendTo(this.element);return false}return true},_onClickLink:function(g,h){var j=h.closest(this.selectors.panel);var a=h.attr("href");if(!a||(a==="#")||(/[ ]*javascript[ ]*:/.test(a)===true)){return true}if(a[0]==="#"){var d=h.closest(this.selectors.panelItems.body);var b=d.find(a.replace(/\./g,"\\."));if(b.length>0){g.preventDefault();d.scrollTop(b.position().top+d.scrollTop()-8);return false}b=d.find("a[name="+a.substr(1)+"]");if(b.length>0){g.preventDefault();d.scrollTop(b.position().top+d.scrollTop()-8);return false}return true}if(/mailto:.+/.test(a)===true){return true}g.preventDefault();if(h.hasClass(this.selectors.exitClass)){window.open(a,h.text().replace(/([^\w])/g,""));return false}if(h.hasClass(this.selectors.activeClass)&&(g.shiftKey===false)&&(g.metaKey===false)){var i=j.next(this.selectors.panel);if(i.is(":hidden")){this.next()}else{this.setPanelFocus(i)}return false}var c={};if(h.text()){c.kTitle=h.text()}var f=this.findLoaderData(a,h,$(g.target));f=$.extend({},c,f);if((g.metaKey===true)||h.hasClass(this.selectors.newTabClass)){this.newTab(f);return false}this.load(f,h)},_onClickNavItem:function(h,c){var f=c.data("load");if(!f){return false}if(c.hasClass(this.selectors.activeClass)&&(h.shiftKey===false)&&(h.metaKey===false)){var g=c.closest(this.selectors.panel).next(this.selectors.panel);if(g.is(":hidden")){this.next()}else{this.setPanelFocus(g)}return false}var d=c.find(this.selectors.items.label).text();var b={kTitle:d};var a=$.extend({},b,f);if((h.metaKey===true)||c.hasClass(this.selectors.newTabClass)){this.newTab(a);return false}this.load(a,c)},_initKeyboardNavigation:function(){var a=this,b=this._state.focus;$(document).keydown(function(h){if(a._state.anims.count>0){return}if($(h.target).is(":input")){return}var g=(h===null)?event.keyCode:h.which;var d=String.fromCharCode(g);switch(g){case 37:if(b.panelIndex>0){if(b.panelIndex<=a._getFirstPanel().kpanel("getState").index){a.prev()}else{a._setPanelFocus(b.panelIndex-1)}}break;case 39:if(b.navItemIndex!==null){var f=a._getFocusedPanel(),c=f.kpanel("getState").$navItems||f.kpanel("buildNavItemsCollection");c.eq(b.navItemIndex).trigger("click");break}if(b.panelIndex<(a._state.panelsCount-1)){if(b.panelIndex>=a._getLastPanel().kpanel("getState").index){a.next()}else{a._setPanelFocus(b.panelIndex+1)}}break;case 38:if(b.navItemIndex===null){a._setNavItemFocus("firstup")}else{a._setNavItemFocus(b.navItemIndex-1)}h.preventDefault();break;case 40:if(b.navItemIndex===null){a._setNavItemFocus("firstdown")}else{a._setNavItemFocus(b.navItemIndex+1)}h.preventDefault();break;case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:a.setColumnsCount(g-96);break;case 107:case 187:a.setColumnsCount(a._state.columnsCount-1);break;case 109:case 189:a.setColumnsCount(a._state.columnsCount+1);break;default:if((g>47)&&(g<91)){if(h.metaKey===true){return}a._onType(d)}}})},_updateColumnsControls:function(){if((Math.floor(this.$kWindow.width()/(this._state.columnsCount+1))<this._constants.minColumnWidth)||(this._state.columnWidth<this._constants.minColumnWidth)){this.element.find(this.selectors.columnsInc).attr("disabled","disabled").addClass(this.selectors.disabledClass)}else{this.element.find(this.selectors.columnsInc).removeAttr("disabled").removeClass(this.selectors.disabledClass)}if(this._state.columnsCount<=1){this.element.find(this.selectors.columnsDec).attr("disabled","disabled").addClass(this.selectors.disabledClass)}else{this.element.find(this.selectors.columnsDec).removeAttr("disabled").removeClass(this.selectors.disabledClass)}this.element.find(this.selectors.columnsCount).html(this._state.columnsCount+" column(s)")},_computeDimensions:function(){this._state.prevWidth=this._state.width;this._state.width=this.$kWindow.width();this._state.height=this.$kWindow.height()-this._constants.topBarHeight;this._state.prevColumnsCount=this._state.columnsCount;if(this.options.columnWidth<=0){console.error("Error computing dimensions!",this.options.columnWidth);throw new Error("Column width must be a positive number!")}this._state.columnsCount=Math.floor(this._state.width/this.options.columnWidth);if(this._state.columnsCount==0){this._state.columnsCount=1}this._state.columnWidth=this._state.width/this._state.columnsCount;if(this._state.columnsCount!==this._state.prevColumnsCount){this._updateColumnsControls()}},_doLayout:function(){if(this._state.anims.count>0){console.warn("Kaiten layout delayed!");this._state.anims.delayedLayout=true;return}if(this.$slider.is(":hidden")){return}this._computeDimensions();this.$slider.css({height:this._state.height+"px"});if(this._state.width!==this._state.prevWidth){this.$breadcrumb.trigger("layout.kbreadcrumb")}var b=this._state.columnsCount-this._state.prevColumnsCount,a;if(b>0){a=this._getFirstPanel();this._expand(a,b)}else{if(b<0){a=this._getLastPanel();if(a.kpanel("getEdgePosition")>this._state.columnsCount){this._reduce(a,a.kpanel("getEdgePosition")-this._state.columnsCount)}}}this._getVisiblePanels().trigger("layout.kpanel")},_expand:function(p,j){var f;var m=this._expandPanel(p,j);if(m<=0){return}var a=this._getNextPanels(":visible",p);for(f=0;f<a.length;f++){m=this._expandPanel(a.eq(f),m);if(m<=0){return}}var k=this._getLastPanel().kpanel("getEdgePosition");var h=this._getNextPanels(":hidden",p);var g,e,o;for(f=0;f<h.length;f++){g=h.eq(f);e=m;o=g.kpanel("getState").optimalWidth;if(e>o){e=o}g.kpanel("setPosition",k,this._state);g.kpanel("setWidth",e,this._state);m-=e;if(m<=0){return}k+=e}var c=0,d;var b=this._getPrevPanels(":hidden",p);for(f=0;f<b.length;f++){g=b.eq(f);o=g.kpanel("getState").optimalWidth;if((c+o)<m){g.kpanel("setWidth",o,this._state);c+=o;g.kpanel("setPosition",-c,this._state)}else{d=m-c;g.kpanel("setWidth",d,this._state);c=m;g.kpanel("setPosition",-c,this._state);break}}if(c>0){this._getVisiblePanels().add(p).each(function(){$(this).kpanel("incPosition",c,this._state)});if(f===b.length){f--}for(f;f>=0;f--){g=b.eq(f);g.kpanel("incPosition",c,this._state);g.show()}}},_expandPanel:function(g,e){var f=g.kpanel("getState");var h=f.width,a=f.optimalWidth;if(h<a){var d=h+e;if(d>a){d=a}g.kpanel("setWidth",d,this._state);var b=this,c=d-h;this._getNextPanels(":visible",g).each(function(){$(this).kpanel("incPosition",c,b._state)});return(e-c)}return e},_reduce:function(e,f){var d,c=f;var a=this._getPrevPanels(":visible",e);for(d=0;d<a.length;d++){c=this._reducePanel(a.eq(d),c);if(c<=0){return}}var b=0;for(d=0;d<a.length;d++){b+=a.eq(d).kpanel("getState").width;if(b>=c){break}}c-=b;this._getVisiblePanels().add(e).each(function(){$(this).kpanel("incPosition",-b,this._state)});if(c<=0){return}c=this._reducePanel(e,c)},_reducePanel:function(f,d){var e=f.kpanel("getState");var g=e.width;if(g>1){var c=g-d;if(c<1){c=1}f.kpanel("setWidth",c,this._state);var a=this,b=g-c;this._getNextPanels(":visible",f).each(function(){$(this).kpanel("incPosition",-b,a._state)});return(d-b)}return d},_createNewPanel:function(c,d,g,h){var j,k,m=d.kWidth||1;if(h.length>0){k=h;j={$src:g,optimalWidth:m,connector:c,cssClass:c.cssClass||"",titleBarOptions:this.options.defaultPanelTitleBarOptions,afterload:null,afterlayout:null,beforedestroy:null,onrefresh:null};var e=k.kpanel("getState",true);if((e.position<0)||(e.position>=this._state.columnsCount)){j.position=this._state.columnsCount;j.width=1}k.kpanel(j);var b=(e.position>=0)&&(e.position<this._state.columnsCount);this.$breadcrumb.kbreadcrumb("toggleVisibility",e.index,b)}else{var i=this._state.panelsCount;this._state.panelsCount+=1;var f=this.selectors.panelIDPrefix+this._state.panelsCount,a=this._getLastAvailablePos();k=$("<div/>").appendTo(this.$slider);j={$src:g,index:i,id:f,position:a,width:1,optimalWidth:m,connector:c,cssClass:c.cssClass||"",titleBarOptions:this.options.defaultPanelTitleBarOptions};k.kpanel(j);this.$breadcrumb.kbreadcrumb("add",j)}this.setPanelFocus(k);return k},_nextPlacement:function(c,b,d){c.kpanel("animate",null,b,this._state,d);var a=this;this._getNextPanels(":visible",c).each(function(){a._nextPanelPlacement($(this),b)})},_nextPanelPlacement:function(e,c){var d=e.kpanel("getState",true),b=d.position+c,a=b+d.width;if(a>this._state.columnsCount){if(b<this._state.columnsCount){var f=((d.position+d.width)<this._state.columnsCount)?-(a-this._state.columnsCount):-c;e.kpanel("animate",c,f,this._state);return}else{if(b>=this._state.columnsCount){c=this._state.columnsCount-d.position}}}e.kpanel("animate",c,null,this._state)},_prevPlacement:function(c,b,d){c.kpanel("animate",b,null,this._state,d);var a=this;this._getPrevPanels(":visible",c).each(function(){a._prevPanelPlacement($(this),b)})},_prevPanelPlacement:function(e,c){var d=e.kpanel("getState",true),b=d.position+c;if(b<0){var a=b+d.width;if(a>0){if(d.position>0){e.kpanel("animate",-d.position,b,this._state)}else{e.kpanel("animate",null,c,this._state)}return}else{if(a<0){c=-(d.position+d.width)}}}e.kpanel("animate",c,null,this._state)},_getVisiblePanels:function(a){var b=this.$slider.children(this.selectors.panel+":visible");if(a){b=b.eq(a)}return b},_getHiddenPanels:function(a){var b=this.$slider.children(this.selectors.panel+":hidden");if(a){b=b.eq(a)}return b},_getFirstPanel:function(){return this._getVisiblePanels().first()},_getLastPanel:function(){return this._getVisiblePanels().last()},_getNextPanels:function(c,a,b){if(b===true){return $(a).nextAll(this.selectors.panel+c).andSelf()}return $(a).nextAll(this.selectors.panel+c)},_getPrevPanels:function(b,a){return $(a).prevAll(this.selectors.panel+b)},_getLastAvailablePos:function(){var b=0;var a=this._getLastPanel();if(a.length>0){b=a.kpanel("getEdgePosition");if(b>this._state.columnsCount){b=this._state.columnsCount}}return b},_sortHiddenPanels:function(d,b){var a,c=b;if(c>0){d.each(function(){a=$(this).kpanel("getState").optimalWidth;$(this).kpanel("setPosition",c);$(this).kpanel("setWidth",a);c+=a})}else{d.each(function(){a=$(this).kpanel("getState").optimalWidth;c-=a;$(this).kpanel("setPosition",c);$(this).kpanel("setWidth",a)})}},_setPanelFocus:function(b){this._setNavItemFocus(null);if(document.activeElement){document.activeElement.blur()}var a="#"+this.selectors.panelIDPrefix;this.element.find(a+(this._state.focus.panelIndex+1)).removeClass(this.selectors.focusClass);this._state.focus.panelIndex=b;this.element.find(a+(b+1)).addClass(this.selectors.focusClass).children(this.selectors.panelItems.body).focus()},_getFocusedPanel:function(){var a="#"+this.selectors.panelIDPrefix;return this.element.find(a+(this._state.focus.panelIndex+1))},_setNavItemFocus:function(j,f){var c=this._getFocusedPanel();var o=c.kpanel("getState");var b=o.$navItems||c.kpanel("buildNavItemsCollection");var d=b.length;if(d===0){this._state.focus.navItemIndex=null;return}if(this._state.focus.navItemIndex!==null){b.eq(this._state.focus.navItemIndex).removeClass(this.selectors.focusClass).removeAttr("tabindex")}if(j===null){this._state.focus.navItemIndex=null;return}if(j==="firstdown"){j=(o.$activeItem.length>0)?b.index(o.$activeItem)+1:0}else{if(j==="firstup"){j=(o.$activeItem.length>0)?b.index(o.$activeItem)-1:d-1}}if(j>=d){this._state.focus.navItemIndex=0}else{if(j<0){this._state.focus.navItemIndex=d-1}else{this._state.focus.navItemIndex=j}}var g=b.eq(this._state.focus.navItemIndex);g.addClass(this.selectors.focusClass).attr("tabindex",-1).focus();if(f===true){return}var e=g.closest(this.selectors.panelItems.body);var h=g.offset().top-e.offset().top;var k=g.height(),a=h+k;var m=e.height(),i=e.scrollTop();if(a>m){e.scrollTop(a+8+i-m)}else{if(h<0){e.scrollTop(h+i-8)}}},_onType:function(d){var c=this._getFocusedPanel();var a=c.kpanel("getState").$navItems||c.kpanel("buildNavItemsCollection");if(a.length===0){this._state.focus.typing="";return}var b=this;this._state.focus.typing+=d.toLowerCase();clearTimeout(this._state.focus.timeoutID);this._state.focus.timeoutID=setTimeout(function(){b._state.focus.typing=""},this._constants.clearTypeDelay);a.each(function(e){if($(this).text().toLowerCase().indexOf(b._state.focus.typing)===0){b._setNavItemFocus(e);return false}})},_prepareConnectorRegistration:function(a,j){var g;if(!$.isPlainObject(a)){throw new Error("Cannot register connector: invalid object!")}if(!a.name){g=(!j)?"Cannot register connector: no name!":'Cannot register connectors collection "'+j.collectionName+'": no connector name!';throw new Error(g)}if(this._state.connectors[a.name]){g=(!j)?'Cannot register connector: "'+a.name+'" already exists!':'Cannot register connectors collection "'+j.collectionName+'": "'+a.name+'" already exists!';throw new Error(g)}var b=["init","destroy","loader","connectable","getData"],e,h;for(e in b){h=b[e];if(a[h]&&!$.isFunction(a[h])){throw new Error('Cannot register connector "'+a.name+'": "'+h+'" is not a function!')}}if(a.cssFile&&!this._state.css[a.cssFile]){this._state.css[a.cssFile]=true;$("<link />",{rel:"stylesheet",type:"text/css",href:a.cssFile}).appendTo($("head"))}var d={initialized:false,cssClass:""};if(!j){d.cssClass=a.name.replace(/[^a-zA-Z0-9]/g,"-")}else{var c=j.collectionName.replace(/[^a-zA-Z0-9]/g,"-");d.cssClass=c;d.cssClass+=" "+c+"-"+a.name.replace(/[^a-zA-Z0-9]/g,"-");d.fullName=j.collectionName+"."+a.name;d.collectionName=j.collectionName;d.collectionInitialized=false}return $.extend(a,d)},findLoaderData:function(a,g,b){var e,d,h,o,k=null;g=g||$();b=b||$();for(e in this._state.connectors){h=this._state.connectors[e];if($.isFunction(h.connectable)&&h.connectable(a,g,b)===true){if(h.connectors){for(d in h.connectors){o=h.connectors[d];if($.isFunction(o.connectable)&&o.connectable(a,g,b)===true){k=o;break}}if(k){break}}else{k=h;break}}}if(k){var f={kConnector:k};if($.isFunction(k.getData)){var m=k.getData(a,g,b);if(m!=false){$.extend(f,m)}else{return false}}}else{f={kConnector:this.options.fallbackConnector,url:a}}return f},registerConnector:function(a){if(a.connectors){this.registerConnectorsCollection(a);return}this._state.connectors[a.name]=this._prepareConnectorRegistration(a)},registerConnectorsCollection:function(d){if(!$.isPlainObject(d)){throw new Error("Cannot register connectors collection: invalid object!")}if(!$.isArray(d.connectors)){throw new Error("Cannot register connectors collection: connectors is not an array!")}if(!d.collectionName){throw new Error("Cannot register connectors collection: no collection name!")}if(this._state.connectors[d.collectionName]){throw new Error('Cannot register connectors collection: "'+d.collectionName+'": already exists!')}var a=["init","destroy","connectable"],b,c;for(b in a){c=a[b];if(d[c]&&!$.isFunction(d[c])){throw new Error('Cannot register connectors collection "'+d.collectionName+'": "'+c+'" is not a function!')}}for(b in d.connectors){d.connectors[b]=this._prepareConnectorRegistration(d.connectors[b],d)}if(d.cssFile&&!this._state.css[d.cssFile]){this._state.css[d.cssFile]=true;$("<link />",{rel:"stylesheet",type:"text/css",href:d.cssFile}).appendTo($("head"))}this._state.connectors[d.collectionName]=$.extend(d,{initialized:false})},unRegisterConnector:function(d){var h=this._state.connectors[d];if(h&&h.connectors){this.unRegisterConnectorsCollection(d);return}if(!h){var b=d.indexOf(".");if(b>-1){var a=d.substring(0,b),f=this.getConnectorsCollection(a),g=d.substring(b+1),e;for(e in f.connectors){h=f.connectors[e];if(h.name===g){delete f.connectors[e];return}}}throw new Error('Cannot remove connector "'+d+'": not found!')}if($.isFunction(h.destroy)){h.destroy(this.element)}delete this._state.connectors[d]},unRegisterConnectorsCollection:function(b){if(!this._state.connectors[b]){console.info('Cannot remove connectors collection "'+b+'": not found!');return}var a=this._state.connectors[b].connectors,c;for(c in a){if($.isFunction(a[c].destroy)){a[c].destroy(this.element)}}if(this._state.connectors[b].destroy){this._state.connectors[b].destroy(this.element)}delete this._state.connectors[b]},getConnector:function(c){if(!c){throw new Error("Cannot retrieve connector: name is undefned!")}if(!this._state.connectors[c]){var b=c.indexOf(".");if(b>-1){var a=c.substring(0,b),e=this.getConnectorsCollection(a),f=c.substring(b+1),d;for(d in e.connectors){if(e.connectors[d].name===f){return e.connectors[d]}}}throw new Error('Connector "'+c+'" not found!')}return this._state.connectors[c]},getConnectorsCollection:function(a){if(!this._state.connectors[a]){throw new Error('Connectors collection "'+a+'" not found!')}return this._state.connectors[a]},load:function(){console.log("Kaiten.load",arguments);var a,d,p,o=arguments;if($.isPlainObject(o[0])){d=o[0];if(d.kConnector){if($.type(d.kConnector)==="string"){a=this.getConnector(d.kConnector)}else{if($.isPlainObject(d.kConnector)){a=d.kConnector;d.kConnector=a.fullName}}if(a.collectionName&&!a.collectionInitialized){var j=this.getConnectorsCollection(a.collectionName);if($.isFunction(j.init)){j.init(this.element);j.initialized=true;for(var f in j.connectors){j.connectors[f].collectionInitialized=true}}}if((a.initialized===false)&&$.isFunction(a.init)){a.init(this.element);a.initialized=true}}else{if($.isFunction(d.kLoader)){a={loader:d.kLoader,name:"On-the-fly (function)"}}}p=o[1]||$()}else{if($.isFunction(o[0])){a={loader:o[0],name:"On-the-fly (function)"};d=o[1]||{};p=o[2]||$()}else{if(($.type(o[0])==="string")||(o[0] instanceof jQuery)){a={loader:function(){return o[0]},name:"On-the-fly (content)"};d={};p=o[1]||$()}}}if(!a){throw new Error("Cannot load. No connector!")}d.kTabID=this._state.tabID;var h=(p.length>0)?p.closest(this.selectors.panel).next(this.selectors.panel):$();if(h.length>0){var c=h.next();if(c.length&&!c.kpanel("destroy",{src:this,fn:this.load,params:o,type:"kaiten.load"})){return false}}var q=this._createNewPanel(a,d,p,h);var g=null;if(q.kpanel("getState",true).position>=this._state.columnsCount){if((h.length===0)||!h.kpanel("isAnimated")){q.show();g=$.Deferred();q.kpanel("animate",-1,null,this._state,function(){g.resolve()});var k=this._getPrevPanels(":visible",q);var b=k.last();if(b.kpanel("getState",true).width>1){var f;b.kpanel("animate",null,-1,this._state);for(f=0,l=k.length;f<l-1;f++){k.eq(f).kpanel("animate",-1,null,this._state)}}else{k.kpanel("animate",-1,null,this._state)}}}try{q.kpanel("load",d,p,g);return q}catch(m){throw m}return q},reload:function(c,a,b){c.kpanel("reload",a,b)},remove:function(a){return a.kpanel("destroy")},removeChildren:function(a){return this.remove(a.next(this.selectors.panel))},newTab:function(c){var b=$.extend({},c);if(b.kTabID){delete b.kTabID}var a;for(a in b){if($.isFunction(b[a])){delete b[a];continue}if(b[a] instanceof jQuery){console.warn('Parameter "'+a+'" is an instance of jQuery. You may encounter navigation issues.');b[a]=$("<div />").append(b[a].clone()).html();continue}}var e=document.location.protocol+"//"+document.location.host+document.location.pathname;var d=$.param(b);e+="?"+d;window.open(e,d.replace(/([^\w])/g,""))},next:function(){if(this._state.anims.count>0){return}var b=this._getLastPanel().next(this.selectors.panel);if(b.length>0){this.setPanelFocus(b);b.kpanel("setPosition",this._state.columnsCount);var c=b.kpanel("setWidthToOptimal",this._state);b.kpanel("toggle",true);var a=this;b.kpanel("animate",-c,null,this._state,function(){this.children(a.selectors.panelItems.body).focus()});this._getPrevPanels(":visible",b).each(function(){a._prevPanelPlacement($(this),-c)})}},prev:function(){if(this._state.anims.count>0){return}var b=this._getFirstPanel().prev(this.selectors.panel);if(b.length>0){this.setPanelFocus(b);var c=b.kpanel("setWidthToOptimal",this._state);b.kpanel("setPosition",-c);b.kpanel("toggle",true);var a=this;b.kpanel("animate",c,null,this._state,function(){this.children(a.selectors.panelItems.body).focus()});this._getNextPanels(":visible",b).each(function(){a._nextPanelPlacement($(this),c)})}},maximize:function(d){if(this._state.anims.count>0){return}var a=this,b,c;this._getPrevPanels(":visible",d).each(function(){b=$(this);b.kpanel("animate",-b.kpanel("getEdgePosition",true),null,a._state)});this._getNextPanels(":visible",d).each(function(){b=$(this);c=b.kpanel("getState",true);b.kpanel("animate",a._state.columnsCount-c.position,null,a._state)});c=d.kpanel("getState",true);d.kpanel("animate",-c.position,this._state.columnsCount-c.width,this._state)},originalSize:function(a){if(this._state.anims.count>0){return}this.slideTo(a)},slideTo:function(h){if(!h.length||(this._state.anims.count>0)){return}this.setPanelFocus(h);var p=this._getVisiblePanels();var a=p.first();var q=a.length?this._getPrevPanels(":hidden",a):this._getHiddenPanels().reverse();this._sortHiddenPanels(q,0);this._sortHiddenPanels(this._getNextPanels(":hidden",a),this._state.columnsCount);var r=h;var j=this._state.columnsCount,s;var o=[];var m=[];do{m.push(r.attr("id"));s=r.kpanel("getState").optimalWidth;o.push({$panel:r,futureWidth:s});j-=s;r=r.next(this.selectors.panel)}while((j>0)&&(r.length>0));if(j<0){o[o.length-1].futureWidth+=j}else{if(j>0){r=h.prev(this.selectors.panel);while((j>0)&&(r.length>0)){m.push(r.attr("id"));s=r.kpanel("getState").optimalWidth;o.unshift({$panel:r,futureWidth:s});j-=s;r=r.prev(this.selectors.panel)}if(j<0){o[0].futureWidth+=j}}}var e=[];p.each(function(){if($.inArray($(this).attr("id"),m)===-1){e.push($(this))}});var g,c=e.length;if(c>0){var b;if(e[0].nextAll("#"+h.attr("id")).length>0){b=-e[c-1].kpanel("getEdgePosition",true);for(g=0;g<c;g++){r=e[g];r.kpanel("animate",b,null,this._state)}}else{b=this._state.columnsCount-e[0].kpanel("getState",true).position;for(g=0;g<c;g++){r=e[g];r.kpanel("animate",b,null,this._state)}}}var f=0;for(g=0,c=o.length;g<c;g++){var d=o[g];var k=d.$panel.kpanel("getState",true);d.$panel.show().kpanel("animate",f-k.position,d.futureWidth-k.width,this._state);f+=d.futureWidth}},setPanelFocus:function(a){if(a.length){this._setPanelFocus(a.kpanel("getState").index)}},prepareKeyboardNavigation:function(){this._setNavItemFocus("firstdown",true)},toggleTopbar:function(a){this.element.find(this.selectors.topbarMask).toggle(!a)},setColumnsCount:function(b){if(this._state.anims.count>0){return}if(!b||(b<=0)){console.error("Error setting columns count!",b);throw new Error("New columns count must be a positive number!")}var a=(1-(1/(2+b)));this.options.columnWidth=(this.$kWindow.width()/b)*a;this._doLayout()},setColumnWidth:function(a){if(this._state.anims.count>0){return}if(!a||(a<=0)){console.error("Error setting column width!",a);throw new Error("New column width must be a positive number!")}this.options.columnWidth=a;this._doLayout()},getState:function(){return this._state},getPanel:function(a){return this.$slider.children(this.selectors.panel).eq(a)}};(function(d,c){if(!c.console){c.console={};var b=["log","debug","info","warn","exception","assert","dir","dirxml","trace","group","groupEnd","groupCollapsed","time","timeEnd","profile","profileEnd","count","clear","table","error","notifyFirebug"],e=function(){};for(var a in b){c.console[a]=e}}d.fn.getPanel=function(){var f;if(!this.length){console.warn("Panel Not Found: jQuery object is empty!");return}if(this.hasClass(Kaiten.selectors.panel)){return this}f=this.closest(Kaiten.selectors.panelClass);if(!f.length){console.log(this);d.error("Panel Not Found!")}return f};d.fn.reverse=function(){return this.pushStack(this.get().reverse(),arguments)};if(!c.kConnectors){c.kConnectors={}}d.widget("ui.kaiten",Kaiten)}(jQuery,window));(function(a){a.widget("ui.kpanel",{options:{$src:a(),index:-1,id:"",position:-1,width:1,optimalWidth:1,connector:null,title:"New panel",cssClass:"",afterload:null,afterlayout:null,beforedestroy:null,onrefresh:null,titleBarOptions:'<div class="block-nav"><div class="items clickable remove-panel"><div class="label">Remove this panel</div></div></div>'},_create:function(){this.$K=a(Kaiten.selectors.window).parent();var b=this.$K.kaiten("getState");this.$breadcrumb=this.$K.find(Kaiten.selectors.breadcrumb);this._state={index:this.options.index,position:this.options.position,width:(this.options.width>b.columnsCount)?b.columnsCount:this.options.width,isVisible:(this.options.position>=0)&&(this.options.position<b.columnsCount),load:{},$activeItem:a(),$navItems:null};this.setOptimalWidth(this.options.optimalWidth,b);this._futureState={position:this._state.position,width:this._state.width,index:this._state.index};this._createMarkup();this._bindEvents();this._doLayout()},_createMarkup:function(){this.element.addClass(Kaiten.selectors.panelClass).attr({id:this.options.id});a("<div />",{"class":Kaiten.selectors.maskClass}).append(a("<div />",{"class":Kaiten.selectors.loaderClass})).appendTo(this.element).show();this._createTitleBar();this._createTitleBarOptions();a("<div />",{"class":Kaiten.selectors.panelItems.headerClass}).appendTo(this.element);this.$body=a("<div />",{"class":Kaiten.selectors.panelItems.bodyClass}).appendTo(this.element)},_setOption:function(b,c){switch(b){case"position":this.setPosition(c);break;case"width":this.setWidth(c);break;case"optimalWidth":this.setOptimalWidth(c);break;case"cssClass":break;case"title":this.setTitle(c);break;case"titleBarOptions":this.element.find(Kaiten.selectors.panelItems.options).remove();this._createTitleBarOptions(c);break;default:break}a.Widget.prototype._setOption.apply(this,arguments)},destroy:function(h,g,b,e){if(!h){var d=arguments;h={src:this,fn:this.destroy,params:d,type:"kpanel.destroy"}}if(!h.$targetPanel){h.$targetPanel=this.element}if(b){h.retry=true}if(e){h.fit=true}if(h.type=="kpanel.load"){if(b){return h.fn.apply(h.src,h.params)}}var c=this.element.nextAll().last();if(c.length){return c.kpanel("destroy",h)}if(!g&&!this._trigger("beforedestroy",0,[h,this.element,this.$K])){console.warn("Panel destruction aborted!",this.element);this.$K.kaiten("slideTo",this.element);return false}var f=this.element.is(h.$targetPanel),i=this.element.prev();if(this._state.load.dfd&&a.isFunction(this._state.load.dfd.abort)){this._state.load.dfd.abort()}this.element.unbind().undelegate();this.element.empty().remove();this.$breadcrumb.kbreadcrumb("cut",this._state.index);this.options.$src.removeClass(Kaiten.selectors.activeClass);this.$K.trigger("afterdestroy.kpanel",[f,h.fit]);a.Widget.prototype.destroy.apply(this,arguments);if(!f){return i.kpanel("destroy",h)}this.$K.kaiten("setPanelFocus",i);if(h.retry===true){return h.fn.apply(h.src,h.params)}return true},_state:{},_constants:{},_log:function(){var b=this._state;console.group("Panel ID="+this.options.id);console.log(this.element);console.log("options",this.options);console.log("states",this._state,this._futureState);console.log("constants",this._constants);console.groupEnd()},_bindEvents:function(){var b=this;this.element.bind("layout.kpanel",function(c){b._doLayout()});this.element.bind("bodylayout.kpanel",function(d,c){b._doBodyLayout(c)});this.element.bind("DOMNodeInserted DOMNodeRemoved",function(c){b._state.$navItems=null})},_createTitleBar:function(){var b=Kaiten.selectors.panelItems;var g='<table><tr><td class="'+b.leftToolbarClass+'"></td><td class="'+b.titleContainerClass+'"><div class="'+b.titleClass+'">'+this.options.title+'</div></td><td class="'+b.rightToolbarClass+'"></td></tr></table>';var k=a(g);var f,d,m,e;var j=Kaiten._constants.panelLeftTools;if(this.options.index===0){if(j.filter){j=j.filter(function(i){return(i.cssClass!="remove")})}else{var c=[],h;for(var f in j){h=j[f];if(h.cssClass!="remove"){c.push(h)}}j=c}}for(f=0,d=j.length;f<d;f++){m=j[f];e=a("<button />",{"class":b.toolClass+" "+m.cssClass,title:m.title});k.find(".left").append(e)}for(f=0,d=Kaiten._constants.panelRightTools.length;f<d;f++){m=Kaiten._constants.panelRightTools[f];e=a("<button />",{"class":b.toolClass+" "+m.cssClass,title:m.title});k.find(".right").append(e)}this.$titleBar=a("<div />",{"class":b.titleBarClass}).append(k).appendTo(this.element)},_createTitleBarOptions:function(e){var c=Kaiten.selectors.items;var d=a("<div />",{"class":Kaiten.selectors.panelItems.optionsClass});e=e||this.options.titleBarOptions;if(e){var b=a(e).clone(true,true);if(this.options.index===0){b.find(c.removePanel).remove()}b.appendTo(d)}d.appendTo(this.element)},_setCSSClass:function(c){var b=Kaiten.selectors.panelClass;if(this.element.hasClass(Kaiten.selectors.focusClass)){b+=" "+Kaiten.selectors.focusClass}b+=" "+c;this.element.attr("class",b)},_insertHTML:function(b){var d=this,f=this.$K.kaiten("getState"),c=b.not("script"),e=b.filter("script");this.element.find(Kaiten.selectors.panelItems.options).hide();this.element.find(Kaiten.selectors.panelItems.header).unbind().undelegate().remove();this.$body.unbind().undelegate().remove();this.element.unbind().undelegate();if((c.filter("."+Kaiten.selectors.panelItems.bodyClass).length===0)&&(c.filter("."+Kaiten.selectors.panelItems.headerClass).length===0)){c=a("<div />",{"class":Kaiten.selectors.panelItems.blockClass}).html(c);c=a("<div />",{"class":Kaiten.selectors.panelItems.bodyClass}).append(c)}this.element.append(c);this._setCSSClass(this.options.cssClass);this.$body=this.element.find(Kaiten.selectors.panelItems.body);this.$body.scrollTop(0);this._bindEvents();e.each(function(){var g="(function(){try {"+this.text+'} catch(e){console.group("Exception caught executing panel Javascript!");console.warn(e);console.trace();console.groupEnd();alert("Exception caught executing panel Javascript! "+e);}}).apply($("#'+d.options.id+"."+Kaiten.selectors.panelClass+'")[0]);';a.globalEval(g)});this.toggleLoader(false);this.element.trigger("layout.kpanel");if(f.hasTouchScreen===false){this.$K.kaiten("prepareKeyboardNavigation")}this._trigger("afterload",0,[this.element,this.$K])},_doLayout:function(){if(this.isAnimated()){return}var b=this.$K.kaiten("getState");this._setPositionAndWidth(this._state.position,this._state.width,b);this._doToolbarLayout(b);this.element.trigger("bodylayout.kpanel",[b]);this._doNavItemsLayout();this._trigger("afterlayout",0,[this.element,this.$K])},_doBodyLayout:function(c){var e=c||this.$K.kaiten("getState");var d=e.height;d-=this.element.find(Kaiten.selectors.panelItems.titleBar).outerHeight(true);d-=this.element.find(Kaiten.selectors.panelItems.header).outerHeight(true);var b=this.element.find(Kaiten.selectors.panelItems.options);if(b.is(":visible")){d-=b.outerHeight(true)}this.$body.css({height:d+"px"})},_doNavItemsLayout:function(){var b=this._state.$navItems||this.$body.find(Kaiten.selectors.items.navigable+", "+Kaiten.selectors.connectable);b.each(function(){var g=a(this),e=g.children();var d=e.filter(Kaiten.selectors.items.label);var f=e.filter(Kaiten.selectors.items.info);var h=g.width()-60;if(f.length===0){d.css({"max-width":Math.floor(h)+"px"});return}d.css({"max-width":""});var c=h-d.width();if(c<=20){d.css({"max-width":Math.floor(h)+"px"});f.hide();return}f.css({"max-width":Math.floor(c)+"px",display:"block"})})},_doToolbarLayout:function(c){if(this.isAnimated()){return}var f=c||this.$K.kaiten("getState");var b=Kaiten.selectors.panelItems.tools;if(!this.element.prev().length){this.element.find(b.prev).addClass(Kaiten.selectors.disabledClass).show()}else{this.element.find(b.prev).removeClass(Kaiten.selectors.disabledClass);var e=this.element.prev();this.element.find(b.prev).toggle(!e.kpanel("isVisible",true,f))}if(!this.element.next().length){this.element.find(b.next).addClass(Kaiten.selectors.disabledClass).show()}else{this.element.find(b.next).removeClass(Kaiten.selectors.disabledClass);var d=this.element.next();this.element.find(b.next).toggle(!d.kpanel("isVisible",true,f))}if(f.columnsCount===1){this.element.find(b.maximize).hide()}else{this.element.find(b.maximize).show();if(this._state.width<f.columnsCount){this.element.find(b.maximize).removeClass(Kaiten.selectors.activeClass)}}},_hideNavTools:function(){var c=this.$K.kaiten("getState");var b=Kaiten.selectors.panelItems.tools;if((this._state.index===0)||((this._state.position<0)&&(this._futureState.position===0))){this.element.find(b.prev).addClass(Kaiten.selectors.disabledClass).show()}else{this.element.find(b.prev).hide()}if(this._state.index===(c.panelsCount-1)||((this._state.position>=c.columnsCount)&&(this.getEdgePosition(true)===c.columnsCount))){this.element.find(b.next).addClass(Kaiten.selectors.disabledClass).show()}else{this.element.find(b.next).hide()}if(c.columnsCount===1){this.element.find(b.maximize).hide()}},_setPositionAndWidth:function(c,e,b){var g=b||this.$K.kaiten("getState");if(e>g.columnsCount){e=g.columnsCount}this._futureState.position=this._state.position=c;this._futureState.width=this._state.width=e;this._state.isVisible=this.isVisible(false,g);var f=this._state.position*g.columnWidth;var d=(this._state.width*g.columnWidth);this.element.css({left:f+"px",width:d+"px",display:(this._state.isVisible===true)?"block":"none"});this.$breadcrumb.kbreadcrumb("toggleVisibility",this._state.index,this._state.isVisible)},maximize:function(){this.$K.kaiten("maximize",this.element)},originalSize:function(){this.$K.kaiten("originalSize",this.element)},toggleLoader:function(c,e){var f=this.element.find(Kaiten.selectors.panelItems.mask),b;switch(e){case"body":b=this.$body;break;case"header":b=this.element.find(Kaiten.selectors.panelItems.header);break;default:b=(e instanceof jQuery)?e:this.element;break}if(!b.length){return}if(c===true){if(!b.data("initialOverflowY")){b.data("initialOverflowY",b.css("overflow-y"))}f.detach().appendTo(b).show();b.scrollTop(0).css("overflow-y","hidden")}else{f.detach().appendTo(this.element).hide();var d=b.css("overflow-y");if(d!=="hidden"){b.css("overflow-y",d)}else{b.css("overflow-y",b.data("initialOverflowY"))}}},load:function(i,b,d,h){if(!a.isFunction(this.options.connector.loader)){throw new Error("No panel loader function!")}if(this._state.load.dfd){if(!h&&!this._trigger("beforedestroy",0,[{src:this,fn:this.load,params:[i,b,d,true],type:"kpanel.load"},this.element,this.$K])){console.warn("Panel loading aborted!",this.element);this.$K.kaiten("slideTo",this.element);return false}}if(b.length>0){b.closest(Kaiten.selectors.panel).kpanel("setActiveItem",b)}this.toggleLoader(true);this.setTitle("Loading...");if(this._state.load.dfd){if(a.isFunction(this._state.load.dfd.abort)){this._state.load.dfd.abort()}else{this._state.load.dfd.reject(this._state.load.dfd,"abort")}}if(this._state.load.dfdAnim){this._state.load.dfdAnim.reject(this._state.load.dfdAnim,"abort")}this._state.load.dfdAnim=d;var c=this,f=[],g;this._state.load.data=i;try{g=this.options.connector.loader(i,this.element,this.$K);if(a.type(g)==="string"){this._state.load.dfd=a.Deferred();this._state.load.dfd.resolve([a(g)])}else{if(g instanceof jQuery){g=g.clone(true,true);this._state.load.dfd=a.Deferred();this._state.load.dfd.resolve([g])}else{if(a.isPlainObject(g)){if(!a.isFunction(g.isResolved)){throw new Error("Loader function has not returned a proper deferred object!")}this._state.load.dfd=g}else{throw new Error("Loader function has returned a value that cannot be handled! ("+a.type(g)+")")}}}}catch(j){this._state.load.dfd=a.Deferred();this._state.load.dfd.reject(j.toString(),"exception")}f.push(this._state.load.dfd);f.push(this._state.load.dfdAnim||{});a.when.apply(this,f).done(function(o,k){var e=a("");if(o){if(a.type(o[0])==="string"){e=a(o[0])}else{if(o[0] instanceof jQuery){e=o[0]}else{if(o[2]){e=a(o[2].responseText)}}}}if(!e.length){c.setTitle("No content?");c._insertHTML(a(""));return}if(i.kTitle!==undefined){c.setTitle(decodeURIComponent(i.kTitle))}var r=c.$K.kaiten("getState"),q;e.each(function(){var s=a(this);if(s.attr("optimal-width")){q=s.attr("optimal-width");return}});if(i.kWidth){q=i.kWidth}c.setOptimalWidth(q,r);var p=c.getState(true);var m=c._state.optimalWidth-p.width;if((m===0)||(!c.isVisible(true,r))){c._insertHTML(e);return}if(m>0){if((p.position+c._state.optimalWidth)>r.columnsCount){c.setWidthToOptimal();c.$K.trigger("prevplacement.kaiten",[c.element,r.columnsCount-c._state.optimalWidth-p.position,function(){c._insertHTML(e)}]);return}else{c.$K.trigger("nextplacement.kaiten",[c.element,m,function(){c._insertHTML(e)}]);return}}else{if(m<0){c.$K.trigger("nextplacement.kaiten",[c.element,m,function(){c._insertHTML(e)}]);return}}}).fail(function(o,q,p){if(q!=="abort"){var m="",k="",e;if(a.isPlainObject(o)){if(a.type(p)==="object"){console.log(p);k=p.message;k+="<br /><br />File: "+p.fileName;k+="<br />Line: "+p.lineNumber}else{if(o.status===0){if(p){k=p+" ("+q+" - "+o.status+")"}else{k="AJAX error: no connection!"}}else{k="An unexpected <strong>"+q+"</strong> has occured!"}}k+="<br /><br /><u>Load parameters</u>:<br />";for(e in c._state.load.data){if(c._state.load.data.hasOwnProperty(e)){k+="<br/>&nbsp;&nbsp;&nbsp;"+e+" : "+c._state.load.data[e]}}if((o.status!==0)&&(o.responseText!=="")){k+="<br /><br/><u>Response</u>:<br />"+o.responseText}}else{k=o}m='<div class="'+Kaiten.selectors.panelItems.bodyClass+'"><div class="'+Kaiten.selectors.panelItems.blockClass+'"><h2>Load error!</h2><p>'+k+"</p></div></div>";c.setTitle("Error!");c._insertHTML(a(m));throw new Error(k)}})},reload:function(c,d){var b=this.element.next();if(!d&&b.length&&!b.kpanel("destroy",{src:this,fn:this.reload,params:[arguments],type:"kpanel.reload"})){return false}if(c){a.extend(this._state.load.data,c)}return this.load(this._state.load.data,a())},newTab:function(){var b=a.extend({},this._state.load.data);this.$K.kaiten("newTab",b)},setTitle:function(b){b=a("<div />").html(b).text();this.element.find(Kaiten.selectors.panelItems.title).html(b);this.$breadcrumb.kbreadcrumb("updateTitle",this.options.index,b)},setPosition:function(c,b){var e=b||this.$K.kaiten("getState");this._futureState.position=this._state.position=c;this._state.isVisible=this.isVisible(false,e);var d=this._state.position*e.columnWidth;this.element.css({left:d+"px",display:(this._state.isVisible===true)?"block":"none"});this.$breadcrumb.kbreadcrumb("toggleVisibility",this._state.index,this._state.isVisible)},incPosition:function(c,b){this.setPosition(this._state.position+c,b)},setWidth:function(d,b){var e=b||this.$K.kaiten("getState");if(d>e.columnsCount){d=e.columnsCount}this._futureState.width=this._state.width=d;var c=(this._state.width*e.columnWidth);this.element.css("width",c+"px")},setWidthToOptimal:function(b){this.setWidth(this._state.optimalWidth,b);return this._state.width},setOptimalWidth:function(e,d){var f=d||this.$K.kaiten("getState");if(e==="fullscreen"){this._state.optimalWidth=f.columnsCount;return}else{if(e==="auto"){var b=f.columnsCount-this.element.prev().kpanel("getEdgePosition");this._state.optimalWidth=(b<=0)?1:b;return}}var c=parseInt(e,10);if(!c){this._state.optimalWidth=1;return}if(/[0-9]px$/.test(e)){c=Math.ceil(c/f.columnWidth)}if(c<1){c=1}else{if(c>f.columnsCount){c=f.columnsCount}}this._state.optimalWidth=c},animate:function(j,c,e,g){var d=e||this.$K.kaiten("getState");var b={};if(j){var f=j*d.columnWidth;b.left="+="+f;this._futureState.position=this._futureState.position+j}if(c){var i=c*d.columnWidth;b.width="+="+i;this._futureState.width=this._futureState.width+c}if(j||c){this.$K.trigger("animstart.kpanel");this._hideNavTools();var h=this;this.element.animate(b,{duration:500,easing:"easeOutExpo",queue:false,complete:function(){h.$K.trigger("animcomplete.kpanel");if(j){h.setPosition(h._futureState.position)}if(c){h.setWidth(h._futureState.width)}if(h.isVisible(false)){h.element.trigger("layout.kpanel")}if(a.isFunction(g)){g.call(h.element)}}})}},toggle:function(b){this.element.toggle(b)},setActiveItem:function(b){this._state.$activeItem.removeClass(Kaiten.selectors.activeClass);this._state.$activeItem=b;this._state.$activeItem.addClass(Kaiten.selectors.activeClass)},isVisible:function(b,c){var e=c||this.$K.kaiten("getState");var d=(b===true)?this._futureState.position:this._state.position;return(d>=0)&&(d<e.columnsCount)},isAnimated:function(){return(this._state.position!==this._futureState.position)},getState:function(b){return(b===true)?this._futureState:this._state},getEdgePosition:function(b){return(b===true)?this._futureState.position+this._futureState.width:this._state.position+this._state.width},buildNavItemsCollection:function(){this._state.$navItems=this.$body.find(Kaiten.selectors.items.navigable+", "+Kaiten.selectors.connectable);this._state.$activeItem=this._state.$navItems.filter("."+Kaiten.selectors.activeClass);return this._state.$navItems},toggleOptions:function(){var b=this;this.element.children(Kaiten.selectors.panelItems.options).slideToggle(100,function(){b.element.trigger("bodylayout.kpanel")})}})}(jQuery));(function(a){a.widget("ui.kbreadcrumb",{options:{minItemWidth:32},_create:function(){this.$K=a(Kaiten.selectors.window).parent();this.$topBar=this.$K.find(Kaiten.selectors.topbar);this._constants.appMenuWidth=this.$K.find(Kaiten.selectors.appMenuContainer).outerWidth()+this.$K.find(Kaiten.selectors.appMenuBorder).outerWidth();this.$list=a("<ul />").appendTo(this.element);var b=this;this.element.bind("layout.kbreadcrumb",function(c){b._doLayout()});this.element.delegate("a","click",function(f){var d=a(this),c=d.parent().attr("id").split("-"),g=b.$K.find("#"+c[1]);if(f.metaKey===true){g.kpanel("newTab");return false}b.$K.kaiten("slideTo",g)})},_setOption:function(b,c){a.Widget.prototype._setOption.apply(this,arguments);switch(b){case"minItemWidth":this.element.find("li").css("min-width",c+"px");this._doLayout();break;default:break}},destroy:function(){this.element.undelegate().unbind().empty().remove();a.Widget.prototype.destroy.apply(this,arguments)},_state:{itemsData:[]},_constants:{appMenuWidth:0},_doLayout:function(){var r=this.$topBar.width()-this._constants.appMenuWidth;var b=this.element.find("li"),o=0;b.each(function(){o+=a(this).outerWidth()});var h=o-r;var u=this,k=[],p,q,c,j,t,g,d,f;if(h>0){var e=Infinity;b.not(":first").each(function(){p=a(this);q=p.width();if(q>u.options.minItemWidth){k.push({$elem:p,width:q});e=Math.min(e,q)}});d=k.length;if(d===0){return}c=h/d;for(g=d-1;g>=0;g--){t=k[g];j=Math.round(c*(t.width/e));f=t.width-j;if(f<this.options.minItemWidth){h-=(t.width-this.options.minItemWidth);if((d===1)&&(h<=0)){f=-h}else{if(g>0){c=h/g}}}else{h-=j}this._doItemLayout(t.$elem,f);if(h<=0){break}}}else{if(h<0){var m=0,s;b.not(":first").each(function(){p=a(this);q=p.width();s=p.data("orig-width");if(q<s){k.push({$elem:p,width:q,origWidth:s});m=Math.max(m,s)}});d=k.length;if(d===0){return}h=-h;c=Math.floor(h/d);for(g=0;g<d;g++){t=k[g];j=Math.round(c*(m/t.origWidth));f=t.width+j;if(f>t.origWidth){h-=(t.origWidth-t.width);if(g<(d-1)){c=h/(d-1-g)}}else{h-=j}this._doItemLayout(t.$elem,f);if(h<=0){break}}}}},_doItemLayout:function(b,c){if(c){if(c<this.options.minItemWidth){c=this.options.minItemWidth}else{if(c>=b.data("orig-width")){c=b.data("orig-width")+1}}b.css("width",c+"px")}},_genDocTitle:function(){var c="",d,b;for(b=this._state.itemsData.length-1;b>0;b--){d=this._state.itemsData[b].title;c+=d+" â "}if(this._state.itemsData.length>0){d=this._state.itemsData[0].title;c+=d}document.title=c},add:function(b){this._state.itemsData[b.index]=b;this._genDocTitle();var c=a("<li />",{id:Kaiten.selectors.breadcrumbItems.itemIDPrefix+"-"+b.id,"class":Kaiten.selectors.breadcrumbItems.lastClass+" "+Kaiten.selectors.visibleClass});var d=a("<a />",{title:b.title,href:"#"});if(this._state.itemsData.length===1){c.addClass(Kaiten.selectors.breadcrumbItems.homeClass);d.attr("accesskey","h");c=c.append(d).appendTo(this.$list)}else{d.append(b.title);c=c.append(d).appendTo(this.$list);c.css("min-width",this.options.minItemWidth+"px").data("orig-width",c.width());c.prev().removeClass(Kaiten.selectors.breadcrumbItems.lastClass);this._doLayout()}},updateTitle:function(c,f){this._state.itemsData[c].title=f;var b="#"+Kaiten.selectors.breadcrumbItems.itemIDPrefix+"-"+this._state.itemsData[c].id+" a";var e=this.element.find(b);e.attr("title",this._state.itemsData[c].title);var d=e.parent();if(!d.hasClass(Kaiten.selectors.breadcrumbItems.homeClass)){d.css("width","");e.html(this._state.itemsData[c].title);d.data("orig-width",d.width());this._doLayout()}this._genDocTitle()},cut:function(d){var c=Kaiten.selectors.breadcrumbItems;var f="#"+c.itemIDPrefix+"-";var b,e;for(e=this._state.itemsData.length-1;e>=d;e--){b=this._state.itemsData.pop();this.element.find(f+b.id).remove()}if(d>0){this.element.find(f+this._state.itemsData[d-1].id).removeClass(c.rVisibleClass+" "+c.rInvisibleClass).addClass(c.lastClass);this._doLayout()}this._genDocTitle()},toggleVisibility:function(d,g){if(!this._state.itemsData[d]){return}var b=Kaiten.selectors.breadcrumbItems,e=Kaiten.selectors.visibleClass,c=this.element.find("#"+b.itemIDPrefix+"-"+this._state.itemsData[d].id),h=c.prev(),f=c.next();c.toggleClass(e,g);if(g){h.toggleClass(b.rVisibleClass,!h.hasClass(e)).removeClass(b.rInvisibleClass);c.toggleClass(b.rInvisibleClass,f.length>0&&!f.hasClass(e)).removeClass(b.rVisibleClass)}else{h.toggleClass(b.rInvisibleClass,h.hasClass(e)).removeClass(b.rVisibleClass);c.toggleClass(b.rVisibleClass,f.length>0&&f.hasClass(e)).removeClass(b.rInvisibleClass)}}})}(jQuery));kTemplater=(function(c,m){function p(t,r,s){if(r["class"]){t+=" "+r["class"]}var u=(r.id)?'id="'+r.id+'"':"";if(!s||(s=="html")){r.content=r.content||"";return'<div class="'+t+'" '+u+">"+r.content+"</div>"}else{var q=c('<div class="'+t+'" '+u+" />");if(r.content){q.append(r.content)}return q}}function o(q,r){return p(m.panelItems.headerClass,q,r)}function b(q,r){return p(m.panelItems.bodyClass,q,r)}function f(s,q,r){return p(s,q,r)}function i(q){var r=q.title||q.label;if(q.info){r+=" /// "+q.info}r=c("<div />").html(r).text();r=r.replace(/\"/g,"&quot;");return r}function e(q){var t=(q.id)?'id="'+q.id+'"':"";var s=m.items.itemsClass+" "+m.items.navigableClass;if(q["class"]){s+=" "+q["class"]}var r="<div "+t+' class="'+s+'" title="'+i(q)+'">';if(q.iconURL){r+='<div class="'+m.items.headClass+'"><img src="'+q.iconURL+'" /></div>'}r+='<div class="'+m.items.labelClass+'">'+q.label+"</div>";if(q.info){r+='<div class="'+m.items.infoClass+'">'+q.info+"</div>"}r+='<div class="'+m.items.tailClass+'" />';r+="</div>";return r}function h(q){var t=(q.id)?'id="'+q.id+'"':"";var s=m.items.itemsClass+" "+m.items.clickableClass;if(q["class"]){s+=" "+q["class"]}var r="<div "+t+' class="'+s+'" title="'+i(q)+'">';if(q.iconURL){r+='<div class="'+m.items.headClass+'"><img src="'+q.iconURL+'" /></div>'}r+='<div class="'+m.items.labelClass+'">'+q.label+"</div>";if(q.info){r+='<div class="'+m.items.infoClass+'">'+q.info+"</div>"}r+="</div>";return r}function k(q){q["class"]=(q["class"])?q["class"]+" "+m.downloadableClass:m.downloadableClass;return h(q)}function j(q){var t=(q.id)?'id="'+q.id+'"':"";var s=m.items.itemsClass+" "+m.items.separatorClass;if(q["class"]){s+=" "+q["class"]}var r="<div "+t+' class="'+s+'" title="'+i(q)+'">';if(q.iconURL){r+='<div class="'+m.items.headClass+'"><img src="'+q.iconURL+'" /></div>'}r+='<div class="'+m.items.labelClass+'">'+q.label+"</div>";if(q.info){r+='<div class="'+m.items.infoClass+'">'+q.info+"</div>"}r+="</div>";return r}function g(q){var t=(q.id)?'id="'+q.id+'"':"";var s=m.items.summaryClass;if(q["class"]){s+=" "+q["class"]}var r="<div "+t+' class="'+s+'">';if(q.iconURL){r+='<img src="'+q.iconURL+'" />'}r+='<div class="'+m.items.labelClass+'">'+q.label+"</div>";if(q.info){r+='<div class="'+m.items.infoClass+'">'+q.info+"</div>"}r+="</div>";return r}function d(q){var s=(q.id)?'id="'+q.id+'"':"";var r="<form "+s+' class="quicksearch" onsubmit="return false;"><div class="container rounded-corners">';q.text=q.text||"";r+='<button class="'+m.items.headClass+' search" />';r+='<input class="input" type="text" value="'+q.text+'" />';r+="<button class=\"tail reset\" onclick=\"$(this).prev('input:text').val('');return false;\" />";r+="</div></form>";return r}function a(s,q,r){var t=null;r=r||{};switch(q){case"panel.body":t=(s==="html")?b(r):c(b(r,"jQuery"));break;case"panel.header":t=(s==="html")?o(r):c(o(r,"jQuery"));break;case"block.content":t=(s==="html")?f("block",r):c(f("block",r,"jQuery"));break;case"block.navigation":t=(s==="html")?f("block-nav",r):c(f("block-nav",r,"jQuery"));break;case"block.noresults":t=(s==="html")?f("block-noresults",r):c(f("block-noresults",r,"jQuery"));break;case"line.navigation":t=e(r);if(s==="html"){if(r.data){throw new Error("Using data on HTML templates is not supported! Please use kTemplater.jQuery() instead.")}}else{t=c(t);t.data("load",r.data)}break;case"line.clickable":t=h(r);if(s==="html"){if(r.data){throw new Error("Using data on HTML templates is not supported! Please use kTemplater.jQuery() instead.")}}else{t=c(t);t.data("load",r.data)}break;case"line.downloadable":t=k(r);if(s==="html"){if(r.url){throw new Error("Using data on HTML templates is not supported! Please use kTemplater.jQuery() instead.")}}else{t=c(t);t.data("load",{url:r.url})}break;case"line.separator":t=(s==="html")?j(r):c(j(r));break;case"line.summary":t=(s==="html")?g(r):c(g(r));break;case"line.search":t=(s==="html")?d(r):c(d(r));break;default:break}if(t===null){throw new Error('Template "'+q+'" not available!')}return t}return{html:function(q,r){return a("html",q,r)},jQuery:function(q,r){return a("jQuery",q,r)}}}(jQuery,Kaiten.selectors));